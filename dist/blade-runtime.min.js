/** Blade Run-time helper functions
	(c) Copyright 2012. Blake Miner. All rights reserved.	
	https://github.com/bminer/node-blade
	http://www.blakeminer.com/
	
	See the full license here:
		https://raw.github.com/bminer/node-blade/master/LICENSE.txt
*/(function(e){function i(e,t,n){n&&(e.filename=t.filename,e.source=t.source),e.line=t.line,e.col=t.col}function s(e,t,n){var r=e.buf.splice(n,e.buf.length-n);Array.prototype.unshift.apply(e.buf,r);for(var i in t.blocks)t.blocks[i].parent==e&&t.blocks[i].pos>=n&&(t.blocks[i].pos-=n)}function o(e,t){var n=e+" ";for(var r=0;r<t-n.length+1;r++)n=" "+n;return n}var t=typeof exports=="object"?exports:{},n={},r={};if(t.client=typeof window!="undefined")window.blade={runtime:t,cachedViews:n,cb:{},mount:"/views/",timeout:15e3};t.escape=function(e){return e==null?"":(new String(e)).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},t.attrs=function(e,n){for(var r in e){var i=e[r];if(i.v==null){if(i.a==null)continue;i.v=i.a,delete i.a}r=="class"&&(i.v instanceof Array&&(i.v=i.v.join(" ")),i.a&&(i.v=(i.v.length>0?i.v+" ":"")+i.a)),i.e?n.push(" "+r+'="'+t.escape(i.v)+'"'):n.push(" "+r+'="'+i.v+'"')}},t.ueid=t.client?1e3:0,t.bind=function(e,t,n,i,s){r[t]={events:e,handler:n};var o="i["+JSON.stringify(e)+"]="+n.toString();if(s){var u=i.length-1;i[u]=i[u].substr(0,i[u].length-3)+";"+o+"-->"}else i.push("<!--"+o+"-->")},t.trigger=e,t.loadTemplate=function(e,r,i,s){typeof i=="function"&&(s=i,typeof r=="object"?(i=r,r=e,e=""):i=null),typeof r=="function"&&(s=r,r=e,i=null,e=""),r.split("/").pop().indexOf(".")<0&&(r+=".blade");if(t.client){r=t.resolve(r);if(n[r])return s(null,n[r]),!0;var o=window.blade;if(o.cb[r])o.cb[r].cb.push(s);else{var u=document.createElement("script");u.type="text/javascript",u.async=!0,u.src=o.mount+r;function a(e,t){for(var i=0;i<e.length;i++)t?e[i](t):e[i](null,n[r])}var f=setTimeout(function(){var e=o.cb[r].cb;delete o.cb[r],u.parentNode.removeChild(u),a(e,new Error("Timeout Error: Blade Template ["+r+"] could not be loaded."))},o.timeout),l=o.cb[r]=function(n,s){clearTimeout(f),delete o.cb[r],u.parentNode.removeChild(u);if(n.length>0){var c=0;for(var h=0;h<n.length;h++)t.loadTemplate(e,n[h],i,function(e,t){if(e)return a(l.cb,e);++c==n.length&&a(l.cb)})}else a(l.cb)};l.cb=[s];var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(u,c)}return!1}return i.synchronous=!0,require("./blade").compileFile(e+"/"+r,i,function(e,t){if(e)return s(e);s(null,t.template)}),!0},t.resolve=function(e){if(t.client){var n=document.createElement("div");return n.innerHTML='<a href="'+t.escape("./"+e)+'"></a>',n=n.firstChild.href,n=n.substr(window.location.href.length).replace(/\/\//g,"/"),n.charAt(0)=="/"&&(n=n.substr(1)),n}},t.include=function(e,n){var r=n.inc,i=n.base,s=n.rel,o=n.filename,u=n.line,a=n.col,f=n.source,l=n.locals;n.inc=!0;if(arguments.length>2){n.locals={};for(var c=2;c<arguments.length;c+=2)n.locals[arguments[c]]=arguments[c+1]}var h=t.loadTemplate(n.base,n.rel+"/"+e,t.compileOptions,function(e,t){if(e)throw e;t(n.locals,function(e,t){if(e)throw e;n.inc=r,n.base=i,n.rel=s,n.filename=o,n.line=u,n.col=a,n.source=f,n.locals=l},n)});if(!h)throw new Error("Included file ["+n.rel+"/"+e+"] could not be loaded synchronously!")},t.func=function(e,t,n){var r=n.func[e]=t;r.filename=n.filename,r.source=n.source},t.call=function(e,t,n){var r=n.func[e],i=[n];if(r==null)throw new Error("Function '"+e+"' is undefined.");for(var s=3;s<arguments.length;s++)i[s-2]=arguments[s];var o=n.filename,u=n.source;n.filename=r.filename,n.source=r.source,r.apply(t,i),n.filename=o,n.source=u},t.capture=function(e,t){for(var n in e.blocks)e.blocks[n].pos>=t&&delete e.blocks[n];return e.splice(t,e.length-t).join("")},t.chunk=function(e,n,r){r.chunk[e]=function(){return t.capture(r,r.length,n.apply(this,arguments))}},t.blockDef=function(e,t,n){var r=t.blocks[e]={parent:t.block||null,buf:[],pos:t.length,numChildren:0},s=["r","blocks","func","locals","cb","base","rel","filename","source"];for(var o in s)r.buf[s[o]]=t[s[o]];r.buf.block=r,r.parent&&r.parent.numChildren++,t.push("");if(n.length>1)r.paramBlock=n;else try{n(r.buf)}catch(u){throw i(t,r.buf),u}},t.blockRender=function(e,t,n){var r=n.blocks[t];if(r==null)throw new Error("Block '"+t+"' is undefined.");if(r.paramBlock==null)throw new Error("Block '"+t+"' is a regular, non-parameterized block, which cannot be rendered.");var o=[r.buf];for(var u=3;u<arguments.length;u++)o[u-2]=arguments[u];e=="r"&&(r.buf.length=0);var a=r.buf.length;try{r.paramBlock.apply(this,o)}catch(f){throw i(n,r.buf,1),f}e=="p"&&s(r,n,a)},t.blockMod=function(e,t,n,r){var o=n.blocks[t];if(o==null)throw new Error("Block '"+t+"' is undefined.");e=="r"&&(delete o.paramBlock,o.buf.length=0);var u=o.buf.length;if(r.length>1)o.paramBlock=r;else try{r(o.buf)}catch(a){throw i(n,o.buf),a}e=="p"&&s(o,n,u)},t.done=function(e){var n=!1;while(!n){n=!0;for(var i in e.blocks){var s=e.blocks[i];!s.done&&s.numChildren==0&&(n=!1,s.parent==null?e[s.pos]=s.buf.join(""):(s.parent.buf[s.pos]=s.buf.join(""),s.parent.numChildren--),s.done=!0)}}e.eventHandlers=r,r={},t.client||(t.ueid=0)},t.rethrow=function(e,t){t==null&&(t=e);if(e.lastFilename==t.filename&&e.lastFilename!=null)return e;t.column=t.column||t.col;var n=e.message+"\n    at "+(t.filename==null?"<anonymous>":t.filename)+(t.line==null?"":":"+t.line+(t.column==null?"":":"+t.column));if(t.source!=null){var r=3,i=t.source.split("\n"),s=Math.max(t.line-r,0),u=Math.min(t.line+r,i.length),a=(new String(u)).length;i=i.slice(s,u),n+="\n\n";for(var f=0;f<i.length;f++)n+=o(f+s+1,a)+(f+s+1==t.line?">	":"|	")+i[f]+"\n"}return e.message=n,e.lastFilename=t.filename,e.filename==null&&e.line==null&&(e.filename=t.filename,e.line=t.line,e.column=t.column),e}})(function(e,t){var r=e.previousSibling,i={},h,n;eval(r.textContent),e.parentNode.removeChild(r);for(r in i){h=r.split(" ");for(n=0;n<h.length;n++)e["on"+h[n]]=i[r]}return e["on"+t[0].type].apply(e,t)});