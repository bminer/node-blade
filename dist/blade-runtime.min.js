/** Blade Run-time helper functions
	(c) Copyright 2012. Blake Miner. All rights reserved.	
	https://github.com/bminer/node-blade
	http://www.blakeminer.com/
	
	See the full license here:
		https://raw.github.com/bminer/node-blade/master/LICENSE.txt
*/(function(){function blockError(e,t){e.filename=t.filename,e.line=t.line,e.col=t.col}function prepend(e,t,n){var r=e.buf.splice(n,e.buf.length-n);Array.prototype.unshift.apply(e.buf,r);for(var i in t.blocks)t.blocks[i].parent==e&&t.blocks[i].pos>=n&&(t.blocks[i].pos-=n)}function pad(e,t){var n=e+" ";for(var r=0;r<t-n.length+1;r++)n=" "+n;return n}var runtime=typeof exports=="object"?exports:{},cachedViews={},eventHandlers={};if(runtime.client=typeof window!="undefined")window.blade={runtime:runtime,cachedViews:cachedViews,cb:{},mount:"/views/"};runtime.escape=function(e){return e==null?"":(new String(e)).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},runtime.attrs=function(e,t){for(var n in e){var r=e[n];if(r.v==null){if(r.a==null)continue;r.v=r.a,delete r.a}n=="class"&&(r.v instanceof Array&&(r.v=r.v.join(" ")),r.a&&(r.v=(r.v.length>0?r.v+" ":"")+r.a)),r.e?t.push(" "+n+'="'+runtime.escape(r.v)+'"'):t.push(" "+n+'="'+r.v+'"')}},runtime.ueid=runtime.client?1e3:0,runtime.bind=function(e,t,n,r){eventHandlers[t]={events:e,handler:n},r.push("<!--"+n.toString()+"-->")},runtime.trigger=function(e,t){var n,r=e.previousSibling;return eval("n=e.on"+t[0].type+"="+r.textContent+";"),e.parentNode.removeChild(r),n.apply(e,t)},runtime.loadTemplate=function(e,t,n,r){typeof n=="function"&&(r=n,typeof t=="object"?(n=t,t=e,e=""):n=null),typeof t=="function"&&(r=t,t=e,n=null,e="");if(runtime.client){t=runtime.resolve(t);if(cachedViews[t])return r(null,cachedViews[t]),!0;var i=window.blade;if(i.cb[t])throw new Error("Template is already loading. Be patient.");var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=i.mount+t;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(s,o);var u=setTimeout(function(){delete i.cb[t],s.parentNode.removeChild(s),r(new Error("Timeout Error: Blade Template ["+t+"] could not be loaded."))},15e3);return i.cb[t]=function(o,a){clearTimeout(u),delete i.cb[t],s.parentNode.removeChild(s);if(o.length>0){var f=0;for(var l=0;l<o.length;l++)runtime.loadTemplate(e,o[l],n,function(e,n){if(e)throw e;++f==o.length&&r(null,cachedViews[t])})}else r(null,cachedViews[t])},!1}return n.synchronous=!0,require("./blade").compileFile(e+"/"+t,n,function(e,t){if(e)return r(e);r(null,t.template)}),!0},runtime.resolve=function(e){if(runtime.client){var t=document.createElement("div");return t.innerHTML='<a href="'+runtime.escape("./"+e)+'"></a>',t=t.firstChild.href,t=t.substr(window.location.href.length).replace(/\/\//g,"/"),t.charAt(0)=="/"&&(t=t.substr(1)),t}},runtime.include=function(e,t){var n=t.inc,r=t.base,i=t.rel,s=t.filename,o=t.line,u=t.col,a=t.source,f=t.locals;t.inc=!0;var l=e.split("/");l=l[l.length-1].indexOf("."),l<0&&(e+=".blade");if(arguments.length>2){t.locals={};for(var c=2;c<arguments.length;c+=2)t.locals[arguments[c]]=arguments[c+1]}var h=runtime.loadTemplate(t.base,t.rel+"/"+e,runtime.compileOptions,function(e,l){if(e)throw e;l(t.locals,function(e,l){if(e)throw e;t.inc=n,t.base=r,t.rel=i,t.filename=s,t.line=o,t.col=u,t.source=a,t.locals=f},t)});if(!h)throw new Error("Included file ["+t.rel+"/"+e+"] could not be loaded synchronously!")},runtime.capture=function(e,t){var n=t.pos;for(var r in e.blocks)e.blocks[r].pos>=n&&delete e.blocks[r];return e.splice(n,e.length-n).join("")},runtime.chunk=function(e,t,n){n.chunk[e]=function(){return runtime.capture(n,t.apply({pos:n.length},arguments))}},runtime.blockDef=function(e,t,n){var r=t.blocks[e]={parent:t.block||null,buf:[],pos:t.length,numChildren:0},i=["r","blocks","func","locals","cb","base","rel"];for(var s in i)r.buf[i[s]]=t[i[s]];r.buf.block=r,r.parent&&r.parent.numChildren++,t.push("");if(n.length>1)r.paramBlock=n;else try{n(r.buf)}catch(o){throw blockError(t,r.buf),o}},runtime.blockRender=function(e,t,n){var r=n.blocks[t];if(r==null)throw new Error("Block '"+t+"' is undefined.");if(r.paramBlock==null)throw new Error("Block '"+t+"' is a regular, non-parameterized block, which cannot be rendered.");var i=[r.buf];for(var s=3;s<arguments.length;s++)i[s-2]=arguments[s];e=="r"&&(r.buf.length=0);var o=r.buf.length;try{r.paramBlock.apply(this,i)}catch(u){throw blockError(n,r.buf),u}e=="p"&&prepend(r,n,o)},runtime.blockMod=function(e,t,n,r){var i=n.blocks[t];if(i==null)throw new Error("Block '"+t+"' is undefined.");e=="r"&&(delete i.paramBlock,i.buf.length=0);var s=i.buf.length;if(r.length>1)i.paramBlock=r;else try{r(i.buf)}catch(o){throw blockError(n,i.buf),o}e=="p"&&prepend(i,n,s)},runtime.done=function(e){var t=!1;while(!t){t=!0;for(var n in e.blocks){var r=e.blocks[n];!r.done&&r.numChildren==0&&(t=!1,r.parent==null?e[r.pos]=r.buf.join(""):(r.parent.buf[r.pos]=r.buf.join(""),r.parent.numChildren--),r.done=!0)}}e.eventHandlers=eventHandlers,eventHandlers={},runtime.client||(runtime.ueid=0)},runtime.rethrow=function(e,t){t==null&&(t=e);if(e.lastFilename==t.filename&&e.lastFilename!=null)return e;t.column=t.column||t.col;var n=e.message+"\n    at "+(t.filename==null?"<anonymous>":t.filename)+(t.line==null?"":":"+t.line+(t.column==null?"":":"+t.column));if(t.source!=null){var r=3,i=t.source.split("\n"),s=Math.max(t.line-r,0),o=Math.min(t.line+r,i.length),u=(new String(o)).length;i=i.slice(s,o),n+="\n\n";for(var a=0;a<i.length;a++)n+=pad(a+s+1,u)+(a+s+1==t.line?">	":"|	")+i[a]+"\n"}return e.message=n,e.lastFilename=t.filename,e.filename==null&&e.line==null&&(e.filename=t.filename,e.line=t.line,e.column=t.column),e}})();